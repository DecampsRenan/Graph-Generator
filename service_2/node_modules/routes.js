// On ajoute les d√©pendances
var app        = global.app,
	bodyParser = require('body-parser'),
	Dijkstra = require('./Dijkstra');

app.use(function(req, res, next) {
	res.header('Access-Control-Allow-Origin', '*');
	res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Access');
	next();
});

app.use(bodyParser.json());
app.use(bodyParser.urlencoded({extended: true}));

app.post('/get', function(req, res) {
	
	var graphe = req.body.graphe,
		source   = graphe.nodes[0].data.id,
		sommets  = [],
		distance = [],
		d;
		
	for (var i=1; i < graphe.nodes.length; i++) {
		sommets.push(parseInt(graphe.nodes[i].data.id));
		distance.push('x');
	}

	for (var j=0; j < graphe.edges.length; j++) {
		if (graphe.edges[j].data.source == source) {
			distance[parseInt(graphe.edges[j].data.target)-2]=parseInt(graphe.edges[j].data.weight);
			graphe.edges.splice(j,1);
			j--;
		}	
	}
	
	d = new Dijkstra(source, sommets, distance, graphe);
	
	res.json(d.path);
});
